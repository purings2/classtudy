---------------------------------------------------
-- 학원 관련 테이블
---------------------------------------------------
-- 관리자 테이블 생성
CREATE TABLE admin (
	adminId 	VARCHAR(16) 	PRIMARY KEY,
	passwd 		VARCHAR(16) 	NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 학원 테이블 생성
CREATE TABLE academy (
	academyNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	academyName VARCHAR(30) 	NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 강의 테이블 생성
CREATE TABLE lecture (
	lectureNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	lectureName VARCHAR(60) 	NOT NULL,
	academyNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE lecture ADD CONSTRAINT lectureAcademyNo FOREIGN KEY (academyNo) REFERENCES academy(academyNo) ON DELETE CASCADE;
---------------------------------------------------
-- 멤버 관련 테이블
---------------------------------------------------
-- 그룹 테이블 생성
-- leader 필요하면 나중에 leader table 생성해서 memberId, groupNo 연결
CREATE TABLE grouplist (
	groupNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	groupName 	VARCHAR(30) 	NOT NULL	
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 멤버 테이블 생성
CREATE TABLE member (
	memberId 	VARCHAR(16) 	PRIMARY KEY,
	passwd 		VARCHAR(16) 	NOT NULL,
	name 		VARCHAR(16) 	NOT NULL,
	dateOfBirth VARCHAR(10) 	NOT NULL,
	gender 		VARCHAR(2) 		NOT NULL,
	tel 		VARCHAR(16) 	NOT NULL,
	zipcode 	VARCHAR(8) 		NOT NULL,
	address 	VARCHAR(60) 	NOT NULL,
	addressDetail VARCHAR(60) 	NOT NULL,
	email 		VARCHAR(40) 	NOT NULL,
	regDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	lectureNo 	INT 			DEFAULT 1,
	grade 		INT 			NOT NULL DEFAULT 0,
	point 		INT 			NOT NULL DEFAULT 0,
	reward 		INT 			NOT NULL DEFAULT 0,
	group1 		INT 			DEFAULT 1,
	group2 		INT 			DEFAULT 1,
	group3 		INT 			DEFAULT 1
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE member ADD CONSTRAINT memberLectureNo 	FOREIGN KEY (lectureNo) REFERENCES lecture(lectureNo) ON DELETE SET NULL;
ALTER TABLE member ADD CONSTRAINT memberGroupNo1 	FOREIGN KEY (group1) REFERENCES grouplist(groupNo) ON DELETE SET NULL;
ALTER TABLE member ADD CONSTRAINT memberGroupNo2 	FOREIGN KEY (group2) REFERENCES grouplist(groupNo) ON DELETE SET NULL;
ALTER TABLE member ADD CONSTRAINT memberGroupNo3 	FOREIGN KEY (group3) REFERENCES grouplist(groupNo) ON DELETE SET NULL;

-- 알림 테이블
CREATE TABLE noti (
	notiNo 		INT 			PRIMARY KEY AUTO_INCREMENT,
	receiver 	VARCHAR(16) 	NOT NULL,
	content 	VARCHAR(100) 	NOT NULL,
	checked 	BOOLEAN 		NOT NULL DEFAULT false,
	sendDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE noti ADD CONSTRAINT notiReceiver FOREIGN KEY (receiver) REFERENCES member(memberId) ON DELETE CASCADE;

-- 포인트 테이블
CREATE TABLE point (
	pointNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	member 		VARCHAR(16) 	NOT NULL,
	content 	VARCHAR(100) 	NOT NULL,
	changeVal 	INT 			NOT NULL,
	accrDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE point ADD CONSTRAINT pointReceiver FOREIGN KEY (member) REFERENCES member(memberId) ON DELETE CASCADE;

-- 적립금 테이블
CREATE TABLE reward (
	rewardNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	member 		VARCHAR(16) 	NOT NULL,
	content 	VARCHAR(100) 	NOT NULL,
	changeVal 	INT 			NOT NULL,
	accrDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE reward ADD CONSTRAINT rewardReceiver FOREIGN KEY (member) REFERENCES member(memberId) ON DELETE CASCADE;

---------------------------------------------------
-- 게시판 테이블
---------------------------------------------------
-- 클래스게시판 테이블 생성
CREATE TABLE classboard (
	boardNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	writer 		VARCHAR(16) 	NOT NULL,
	title 		VARCHAR(50) 	NOT NULL,
	content 	TEXT 			NOT NULL,
	category 	SET('TIL', '질문', '클래스') NOT NULL,
	views 		INT 			NOT NULL DEFAULT 0,
	likes 		INT 			NOT NULL DEFAULT 0,
	writeDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	lectureNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE classboard ADD CONSTRAINT classboardWriter 	FOREIGN KEY (writer) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE classboard ADD CONSTRAINT classboardLectureNo 	FOREIGN KEY (lectureNo) REFERENCES lecture(lectureNo) ON DELETE CASCADE;

-- 자유게시판 테이블 생성
CREATE TABLE freeboard (
	boardNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	writer 		VARCHAR(16) 	NOT NULL,
	title 		VARCHAR(50) 	NOT NULL,
	content 	TEXT 			NOT NULL,
	category 	SET('공지사항', '질문', '정보', '이야기', '그룹홍보') NOT NULL,
	views 		INT 			NOT NULL DEFAULT 0,
	likes 		INT 			NOT NULL DEFAULT 0,
	writeDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	tags 		SET('Java', 'Python', 'JavaScript', 'Back-End', '웹 개발', '앱 개발', 'HTML/CSS', 'Front-End', '데이터베이스', 
			    '게임 개발', 'Android', 'Spring', 'Node.js', '알고리즘', 'React', '머신러닝', 'SQL', '인공지능', '정보보안', 
			    '블록체인', 'DevOps', '클라우드', 'Linux', 'iOS', 'Swift', 'Spring Boot', 'Bootstrap', 'jQuery', 'Git', 
			    'Django', 'UI/UX', '3D 모델링', 'Flask', 'After Effects', 'Premiere Pro', 'Photoshop', 'Illustrator', 
			    'R', '편집 디자인', 'Unity', 'JSP', 'JDBC', 'JSTL', '해킹', 'InDesign')
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE freeboard ADD CONSTRAINT freeboardWriter FOREIGN KEY (writer) REFERENCES member(memberId) ON DELETE CASCADE;


-- 그룹게시판 테이블 생성
CREATE TABLE groupboard (
	boardNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	writer 		VARCHAR(16) 	NOT NULL,
	title 		VARCHAR(50) 	NOT NULL,
	content 	TEXT 			NOT NULL,
	views 		INT 			NOT NULL DEFAULT 0,
	likes 		INT 			NOT NULL DEFAULT 0,
	writeDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	groupNo 	INT 			NOT NULL,
	tags 		SET('Java', 'Python', 'JavaScript', 'Back-End', '웹 개발', '앱 개발', 'HTML/CSS', 'Front-End', '데이터베이스', 
			    '게임 개발', 'Android', 'Spring', 'Node.js', '알고리즘', 'React', '머신러닝', 'SQL', '인공지능', '정보보안', 
			    '블록체인', 'DevOps', '클라우드', 'Linux', 'iOS', 'Swift', 'Spring Boot', 'Bootstrap', 'jQuery', 'Git', 
			    'Django', 'UI/UX', '3D 모델링', 'Flask', 'After Effects', 'Premiere Pro', 'Photoshop', 'Illustrator', 
			    'R', '편집 디자인', 'Unity', 'JSP', 'JDBC', 'JSTL', '해킹', 'InDesign')
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE groupboard ADD 	CONSTRAINT groupboardWriter 	FOREIGN KEY (writer) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE groupboard ADD 	CONSTRAINT groupboardGroupNo 	FOREIGN KEY (groupNo) REFERENCES grouplist(groupNo) ON DELETE CASCADE;

---------------------------------------------------
-- 댓글 테이블
---------------------------------------------------
-- 클래스게시판 댓글 테이블 생성
CREATE TABLE cbcomment (
	commentNo 	INT 		PRIMARY KEY AUTO_INCREMENT,
	writer 		VARCHAR(16) 	NOT NULL,
	content 	TEXT 			NOT NULL,
	writeDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	boardNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE cbcomment ADD 		CONSTRAINT cbcommentWriter 	FOREIGN KEY (writer) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE cbcomment ADD 		CONSTRAINT cbcommentBoardNo FOREIGN KEY (boardNo) REFERENCES classboard(boardNo) ON DELETE CASCADE;


-- 자유게시판 댓글 테이블 생성
CREATE TABLE fbcomment (
	commentNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	writer 		VARCHAR(16) 	NOT NULL,
	content 	TEXT 			NOT NULL,
	likes 		INT 			NOT NULL DEFAULT 0,
	writeDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	boardNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE fbcomment ADD 		CONSTRAINT fbcommentWriter 	FOREIGN KEY (writer) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE fbcomment ADD 		CONSTRAINT fbcommentBoardNo FOREIGN KEY (boardNo) REFERENCES freeboard(boardNo) ON DELETE CASCADE;

-- 그룹게시판 댓글 테이블 생성
CREATE TABLE gbcomment (
	commentNo 	INT 		PRIMARY KEY AUTO_INCREMENT,
	writer 		VARCHAR(16) 	NOT NULL,
	content 	TEXT 			NOT NULL,
	writeDate 	TIMESTAMP 		NOT NULL DEFAULT CURRENT_TIMESTAMP,
	boardNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE gbcomment ADD 	CONSTRAINT gbcommentWriter 	FOREIGN KEY (writer) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE gbcomment ADD 	CONSTRAINT gbcommentBoardNo FOREIGN KEY (boardNo) REFERENCES groupboard(boardNo) ON DELETE CASCADE;


---------------------------------------------------
-- 좋아요 테이블
---------------------------------------------------
-- 클래스게시판 좋아요 테이블 생성
CREATE TABLE cblikes (
	likesNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	memberId 	VARCHAR(16) 	NOT NULL,
	boardNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE cblikes ADD 	CONSTRAINT cblikesMemberId 	FOREIGN KEY (memberId) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE cblikes ADD 	CONSTRAINT cblikesBoardNo 	FOREIGN KEY (boardNo) REFERENCES classboard(boardNo) ON DELETE CASCADE;



-- 자유게시판 좋아요 테이블 생성
CREATE TABLE fblikes (
	likesNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	memberId 	VARCHAR(16) 	NOT NULL,
	boardNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE fblikes ADD 	CONSTRAINT fblikesMemberId 	FOREIGN KEY (memberId) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE fblikes ADD 	CONSTRAINT fblikesBoardNo 	FOREIGN KEY (boardNo) REFERENCES freeboard(boardNo) ON DELETE CASCADE;

-- 자유게시판 댓글 좋아요 테이블 생성
CREATE TABLE fbcommentlikes (
	likesNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	memberId 	VARCHAR(16) 	NOT NULL,
	commentNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE fbcommentlikes ADD 	CONSTRAINT fbcommentlikesMemberId 	FOREIGN KEY (memberId) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE fbcommentlikes ADD 	CONSTRAINT fbcommentlikesCommentNo 	FOREIGN KEY (commentNo) REFERENCES fbcomment(commentNo) ON DELETE CASCADE;

-- 그룹게시판 좋아요 테이블 생성
CREATE TABLE gblikes (
	likesNo 	INT 			PRIMARY KEY AUTO_INCREMENT,
	memberId 	VARCHAR(16) 	NOT NULL,
	boardNo 	INT 			NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE gblikes ADD 	CONSTRAINT gblikesMemberId 	FOREIGN KEY (memberId) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE gblikes ADD 	CONSTRAINT gblikesBoardNo 	FOREIGN KEY (boardNo) REFERENCES groupboard(boardNo) ON DELETE CASCADE;

---------------------------------------------------
-- 관리자 전용 테이블
---------------------------------------------------
-- 강의번호 신청 확인 테이블
CREATE TABLE registerlist (
	listNo 		INT 			PRIMARY KEY AUTO_INCREMENT,
	member 		VARCHAR(16) 	NOT NULL,
	lectureNo 	INT 			NOT NULL,
	checked 	BOOLEAN 		NOT NULL DEFAULT false
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
ALTER TABLE registerlist ADD 	CONSTRAINT registerMemberId FOREIGN KEY (member) REFERENCES member(memberId) ON DELETE CASCADE;
ALTER TABLE registerlist ADD 	CONSTRAINT registerLectureNo FOREIGN KEY (lectureNo) REFERENCES lecture(lectureNo) ON DELETE CASCADE;



---------------------------------------------------
-- [db 전체 삭제]
---------------------------------------------------
SET @tables = NULL;
SELECT GROUP_CONCAT(table_schema, '.', table_name) INTO @tables
    FROM information_schema.tables
    WHERE table_schema = 'classtudydb';

SET @tables = CONCAT('DROP TABLE ', @tables);
PREPARE stmt FROM @tables;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;



---------------------------------------------------
-- 테스트 DB --
---------------------------------------------------

-- 학원, 강의, 그룹
INSERT INTO academy (academyName) VALUES ('테스트 학원');
INSERT INTO lecture (lectureName, academyNo) VALUES ('테스트 강의', 1);
INSERT INTO grouplist VALUES(1, '그룹 없음'); 		

-- 그룹보드 게시글 
INSERT INTO groupboard (WRITER, TITLE, CONTENT, writeDate, groupNo, tags) 
				VALUES ("leoleo", "자바그룹 게시물입니다.", "123", now(), 1, "Java,데이터베이스,정보보안,3D모델링");

INSERT INTO groupboard (writer, title, content, writeDate, groupNo, tags) 
 				VALUES ("leoleo", "Group", "123", now(), 1, "Java,Spring") ;
 				
 				
-- main 방문자수 				
CREATE TABLE visit (
	hitNo		INT(11)		PRIMARY KEY AUTO_INCREMENT,
	hitDate 	DATE 		NOT NULL,
	hit 		INT(11) 	NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- main 테스트 컬럼(필수)	
INSERT	INTO visit
			(hitDate, hit) 
	VALUES	(Date('2012-08-12'),1);
	
	
alter table groupboard drop column tags;
alter table freeboard drop column tags;
alter table groupboard add column tags SET('Java', 'Python', 'JavaScript', 'Back-End', '웹 개발', '앱 개발', 'HTML/CSS', 'Front-End', '데이터베이스', '게임 개발', 'Android', 'Spring', 'Node.js', '알고리즘', 'React', '머신러닝', 'SQL', '인공지능', '정보보안', '블록체인', 'DevOps', '클라우드', 'Linux', 'iOS', 'Swift', 'Spring Boot', 'Bootstrap', 'jQuery', 'Git', 'Django', 'UI/UX', '3D 모델링', 'Flask', 'After Effects', 'Premiere Pro', 'Photoshop', 'Illustrator', 'R', '편집 디자인', 'Unity', 'JSP', 'JDBC', 'JSTL', '해킹', 'InDesign');
alter table freeboard add column tags SET('Java', 'Python', 'JavaScript', 'Back-End', '웹 개발', '앱 개발', 'HTML/CSS', 'Front-End', '데이터베이스', '게임 개발', 'Android', 'Spring', 'Node.js', '알고리즘', 'React', '머신러닝', 'SQL', '인공지능', '정보보안', '블록체인', 'DevOps', '클라우드', 'Linux', 'iOS', 'Swift', 'Spring Boot', 'Bootstrap', 'jQuery', 'Git', 'Django', 'UI/UX', '3D 모델링', 'Flask', 'After Effects', 'Premiere Pro', 'Photoshop', 'Illustrator', 'R', '편집 디자인', 'Unity', 'JSP', 'JDBC', 'JSTL', '해킹', 'InDesign');

 				